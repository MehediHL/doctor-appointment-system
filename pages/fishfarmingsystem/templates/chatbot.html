{% extends 'base.html' %}

{% block title %}AquaSmart | Fish Farming Chatbot{% endblock %}

{% block styles %}
 <link rel="stylesheet" href="{{ url_for('static', filename='chatbot.css') }}">
{% endblock %}

{% block content %}
<div class="AB">
  <!-- Chatbot Section -->
  <main class="chatbot-section">
    <div class="chat-container">
      <h2>üêü AquaSmart Fish Farming Chatbot</h2>
      <div id="chatbox"></div>

      <div class="input-area">
        <input type="text" id="userInput" placeholder="Ask about fish farming...">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </main>
  <script>
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const msg = input.value.trim();
      if (!msg) return;

      const chatbox = document.getElementById("chatbox");
      chatbox.innerHTML += `<div class="user"><b>You:</b> ${msg}</div>`;
      input.value = "";

      const typingDiv = document.createElement("div");
      typingDiv.classList.add("typing");
      typingDiv.innerText = "ü§ñ Bot is typing...";
      chatbox.appendChild(typingDiv);
      chatbox.scrollTop = chatbox.scrollHeight;

      try {
        const res = await fetch("/chatbot", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg })
        });
        const data = await res.json();

        typingDiv.remove();
        chatbox.innerHTML += `<div class="bot"><b>Bot:</b> ${data.response}</div>`;
        chatbox.scrollTop = chatbox.scrollHeight;
      } catch (err) {
        typingDiv.remove();
        chatbox.innerHTML += `<div class="bot"><b>Bot:</b> ‚ùå Error connecting to server</div>`;
      }
    }

    document.getElementById("userInput").addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        sendMessage();
      }
    });
  </script>
</div>
{% endblock %}
